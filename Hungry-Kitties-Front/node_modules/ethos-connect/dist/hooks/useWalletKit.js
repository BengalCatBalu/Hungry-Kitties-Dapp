import{useCallback as c,useEffect as I,useMemo as w,useRef as b,useSyncExternalStore as K}from"react";import{createWalletKitCore as P}from"@mysten/wallet-kit-core";import{UnsafeBurnerWalletAdapter as M,WalletStandardAdapterProvider as U}from"@mysten/wallet-adapter-all-wallets";import{SignerType as v}from"../types/Signer.js";import{DEFAULT_CHAIN as i}from"../lib/constants.js";const C=({defaultChain:s,configuredAdapters:l,features:E,enableUnsafeBurner:S,preferredWallets:h,storageAdapter:y,storageKey:A,disableAutoConnect:W})=>{const T=w(()=>l??[new U({features:E}),...S?[new M]:[]],[l]),r=b(null);r.current||(r.current=P({adapters:T,preferredWallets:h,storageAdapter:y,storageKey:A}));const{wallets:u,status:g,currentWallet:e,accounts:m,currentAccount:n}=K(r.current.subscribe,r.current.getState,r.current.getState);I(()=>{W||r.current?.autoconnect()},[g,u]);const{autoconnect:N,...k}=r.current,p=c(t=>{if(!e||!n)throw new Error("No wallet connect to sign message");const o=t.account||n,a=t.chain||s||i;return e.signAndExecuteTransactionBlock({...t,account:o,chain:a})},[e,n,s]),B=c(t=>{if(!e||!n)throw new Error("No wallet connect to sign message");const o=t.account||n,a=t.chain||s||i;return e.signTransactionBlock({...t,account:o,chain:a})},[e,n,s]),f=c(t=>{if(!e||!n)throw new Error("No wallet connect to sign message");const o=t.account||n,a=typeof t.message=="string"?new Uint8Array(Buffer.from(t.message,"utf8")):t.message;return e.signMessage({...t,message:a,account:o})},[e,n]),d=c(async t=>{if(!e||!n)throw new Error("No wallet connect to preapprove transactions");const o=window.ethosWallet;return!o||e.name!=="Ethos Wallet"?(console.log("Wallet does not support preapproval"),!1):(t.address||(t.address=n.address),t.chain||(t.chain=s??i),o.requestPreapproval(t))},[e,n,s]),x=w(()=>!e||!n?null:{type:v.Extension,name:e.name,icon:e.name==="Sui Wallet"?"https://sui.io/favicon.png":e.icon,getAddress:async()=>n?.address,accounts:m,currentAccount:n,signAndExecuteTransactionBlock:p,signTransactionBlock:B,requestPreapproval:d,signMessage:f,disconnect:()=>{e.disconnect(),r.current?.disconnect()}},[e,m,n,p,d,f]);return{wallets:u,status:g,signer:x,...k}};var tt=C;export{tt as default};
