import{useCallback as a,useEffect as h,useState as u}from"react";import v from"./useWalletAdapters.js";import s from"../lib/log.js";const f="preferredSuiWallet",P=()=>{const C=v(),[n,A]=u([]),[t,E]=u(null),[r,p]=u(!1),[d,m]=u(!1),[y,W]=u(!1);h(()=>{A(C)},[C]),h(()=>{r&&t&&localStorage.setItem(f,t.name)},[t,r]);const g=a(async l=>{var o;if(!n)return!1;let e=(o=n.find(i=>i.name===l))!=null?o:null;E(e),e&&!d&&e.connecting&&await e.disconnect();let c=!1;if(e&&!(e==null?void 0:e.connecting))try{m(!0),await e.connect(),p(!0),c=!0}catch(i){p(!1)}finally{m(!1)}return c},[n,p,m]);h(()=>{(async()=>{if(s("suiWalletConnect","Wallets",(n||[]).map(e=>e.name)),!n||n.length===0){s("suiWalletConnect","setNoConnection2"),W(!0);return}if(!t&&!r&&!d){let e=localStorage.getItem(f);if(typeof e!="string"){s("suiWalletConnect","Connected Wallets",(n||[]).map(o=>o.name));const c=(n||[]).find(o=>o.name==="Ethos Mobile");if(c)e=c.name;else if(location.origin==="https://ethoswallet.xyz"||location.origin==="https://beta.ethoswallet.xyz"){s("suiWalletConnect","Wallet explorer",(n||[]).map(i=>i.name));const o=(n||[]).find(i=>i.name==="Ethos Wallet");o&&(s("suiWalletConnect","Ethos wallet connected",o.connected),e=o.name)}}if(typeof e=="string"){await g(e)||(s("suiWalletConnect","setNoConnection0"),W(!0),localStorage.removeItem(f));return}s("suiWalletConnect","setNoConnection1"),W(!0)}})()},[n,t,r,d,g]);const w=a(async()=>{if(t==null)throw Error("Wallet Not Connected");return t.getAccounts()},[t]),S=a(async()=>{if(t==null)throw Error("Wallet Not Connected");return(await w())[0]},[w]),x=a(()=>{if(p(!1),localStorage.removeItem(f),t==null)throw Error("Wallet Not Connected");if(!t.disconnect)throw new Error('Wallet does not support "disconnect" method');t.disconnect(),E(null)},[t]),T=a(async(l,e)=>{if(t==null)throw new Error("Wallet Not Connected");if(!t.signAndExecuteTransaction)throw new Error('Wallet does not support "signAndExecuteTransaction" method');return t.signAndExecuteTransaction(l,e)},[t]),b=a(async l=>{if(t==null)throw new Error("Wallet Not Connected");const e=window.ethosWallet;return!e||t.name!=="Ethos Wallet"?(console.log("Wallet does not support preapproval"),!1):e.requestPreapproval(l)},[r]),N=a(async({message:l})=>{if(t==null)throw new Error("Wallet Not Connected");const e=window.ethosWallet;return!e||t.name!=="Ethos Wallet"?(console.log("Wallet does not support sign"),!1):e.signMessage(l)},[t]);return{wallets:n,wallet:t,connecting:d,noConnection:y,connected:r,select:g,getAccounts:w,getAddress:S,signAndExecuteTransaction:T,requestPreapproval:b,sign:N,disconnect:x}};var D=P;export{D as default};
