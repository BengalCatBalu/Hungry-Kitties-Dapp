import{Connection as _,JsonRpcProvider as D}from"@mysten/sui.js";import{newBN as g,sumBN as N}from"./bigNumber.js";import A,{isBagNFT as $}from"./getBagNFT.js";import{DEFAULT_NETWORK as G}from"./constants.js";import P from"./getDisplay.js";const F=o=>o?(o.indexOf("ipfs")===0&&(o=`https://ipfs.io/ipfs/${o.substring(5)}`),o):"",y={suiBalance:g(0),nfts:[],tokens:{},objects:[]},R=async({address:o,network:S,existingContents:l})=>{try{const f=new _({fullnode:S||G}),h=new D(f);if(!o)return y;const b=await h.getOwnedObjects({owner:o,options:{showType:!0,showOwner:!0,showContent:!0,showDisplay:!0}});if(b.data.length===0)return l===y?null:y;const w=[];let p=[];if(l?.objects&&l.objects.length>0)for(const n of b.data){if(!n.data||n.error)continue;const e=l?.objects.find(c=>typeof n.data=="object"&&typeof c.data=="object"?c.data.objectId===n.data.objectId&&c.data.version===n.data.version:!1);e?w.push(e):p.push(n)}else p=b.data;if(p.length===0)return null;const T=p,W=w.concat(T);let j=g(0);const m=[],s={},I=[];for(const n of W){const{data:e}=n;if(!e)continue;const{display:c,content:{fields:d}}=e,t=P(c);try{const u=(e.type||"").split("<"),r=(u[1]||"").replace(/>/,""),i=u[0].split("::"),x=i[i.length-1],{name:v,description:C,...k}=d??{};if(I.push({...n,type:e?.type,version:e?.version,objectId:e?.objectId,name:v,description:C,display:t,extraFields:k}),x==="Coin")r==="0x2::sui::SUI"&&(j=N(j,d.balance)),s[r]||(s[r]={balance:0,coins:[]}),s[r].balance=N(s[r].balance,d.balance),s[r].coins.push({objectId:e?.objectId,type:e?.type,balance:g(d.balance),digest:e?.digest,version:e?.version,display:t});else if($(n.data)){const a=await A(h,n.data);"name"in a&&m.push({type:e?.type,package:i[0],chain:"Sui",address:e?.objectId,objectId:e?.objectId,name:t?.name??a.name,description:t?.name??a.description,imageUri:F(t?.image_url??a.url),link:t?.link,creator:t?.creator,projectUrl:t?.project_url,display:t,module:i[1],links:{Explorer:`https://explorer.sui.io/objects/${n?.objectId}`}})}else{const{url:a,image_url:B,image:U,...E}=k||{},O=F(t?.image_url||a||B||U);O&&m.push({type:e?.type,package:i[0],chain:"Sui",address:e?.objectId,objectId:e?.objectId,name:t?.name??v,description:t?.description??C,imageUri:O,link:t?.link,creator:t?.creator,projectUrl:t?.project_url,display:t,extraFields:E,module:i[1],links:{Explorer:`https://explorer.sui.io/objects/${n?.objectId}`}})}}catch(u){console.log("Error retrieving object",n,u)}}return{suiBalance:j,tokens:s,nfts:m,objects:I}}catch(f){return console.log("Error retrieving wallet contents",f),null}};var Y=R;export{Y as default,F as ipfsConversion};
