import o from"store2";import k from"./getConfiguration.js";import g from"./log.js";import w from"./postIFrameMessage.js";const I=p=>{const{apiKey:l,walletAppUrl:a}=k();if(g("getIframe","getIframe",l,a),!l||!a)return;const f="ethos-wallet-iframe";let c=0,e=document.getElementById(f);const d=()=>{!e||(e.style.width="1px",e.style.height="1px")},s=new URLSearchParams(window.location.search),i=s.get("access_token"),m=s.get("refresh_token");let r=a+`/wallet?apiKey=${l}`;if(i&&m){r+=`&access_token=${i}&refresh_token=${m}`,s.delete("access_token"),s.delete("refresh_token");let t=location.protocol+"//"+location.host+location.pathname;s.toString().length>0&&(t+="?"+s.toString()),o.namespace("auth")("access_token",i),o.namespace("auth")("refresh_token",m),window.history.pushState({},"",t)}else{const t=o.namespace("auth")("access_token"),n=o.namespace("auth")("refresh_token");t&&n&&(r+=`&access_token=${t}&refresh_token=${n}`)}return e||(g("getIframe","Load Iframe",r),e=document.createElement("IFRAME"),e.src=r,e.id=f,e.style.border="none",e.style.position="absolute",e.style.top=c-1+"px",e.style.right="60px",e.style.width="1px",e.style.height="1px",e.style.zIndex="99",e.style.backgroundColor="transparent",e.setAttribute("allow","payment; clipboard-read; clipboard-write"),document.body.appendChild(e),window.addEventListener("message",t=>{if(t.origin===a){const{action:n}=t.data;switch(n){case"close":d();break;case"ready":e.setAttribute("readyToReceiveMessages","true");const h=o.namespace("iframeMessages"),u=h("messages")||[];for(const y of u)w(y);h("messages",null);break}}}),window.addEventListener("scroll",()=>{c=window.scrollY,e.style.top=c+"px"})),p?(e.style.width="360px",e.style.height="600px"):p!==void 0&&d(),e};var M=I;export{M as default};
